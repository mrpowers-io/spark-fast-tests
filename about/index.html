<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Spark Fast Tests</title>
  
  
  <meta name="description" content="spark-fast-tests"/>
  
  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../helium/site/laika-helium.css" />
  <script src="../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="icon-link glyph-link" href="../"><i class="icofont-laika home" title="Home">&#xef47;</i></a>

  <div class="row links">
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
  </div>

  <ul class="nav-list">
    <li class="level1 active nav-leaf"><a href="#">Spark Fast Tests</a></li>
  </ul>

</nav>

    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Spark Fast Tests</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#install">Install</a></li>
    <li class="level1 nav-leaf"><a href="#simple-examples">Simple examples</a></li>
    <li class="level1 nav-leaf"><a href="#why-is-this-library-fast">Why is this library fast?</a></li>
    <li class="level1 nav-node"><a href="#usage">Usage</a></li>
    <li class="level2 nav-leaf"><a href="#column-equality">Column Equality</a></li>
    <li class="level2 nav-leaf"><a href="#unordered-dataframe-equality-comparisons">Unordered DataFrame equality comparisons</a></li>
    <li class="level2 nav-leaf"><a href="#equality-comparisons-ignoring-the-nullable-flag">Equality comparisons ignoring the nullable flag</a></li>
    <li class="level2 nav-leaf"><a href="#approximate-dataframe-equality">Approximate DataFrame Equality</a></li>
    <li class="level1 nav-leaf"><a href="#testing-tips">Testing Tips</a></li>
    <li class="level1 nav-leaf"><a href="#alternatives">Alternatives</a></li>
    <li class="level1 nav-leaf"><a href="#publishing">Publishing</a></li>
    <li class="level1 nav-leaf"><a href="#additional-goals">Additional Goals</a></li>
    <li class="level1 nav-leaf"><a href="#contributing">Contributing</a></li>
    <li class="level1 nav-leaf"><a href="#utest-settings-to-display-color-output">uTest settings to display color output</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="spark-fast-tests" class="title">Spark Fast Tests</h1>
        <p><a href="https://github.com/MrPowers/spark-fast-tests/actions/workflows/ci.yml"><img src="https://github.com/MrPowers/spark-fast-tests/actions/workflows/ci.yml/badge.svg" alt="CI"></a></p>
        <p>A fast Apache Spark testing helper library with beautifully formatted error messages!  Works with <a href="https://github.com/scalatest/scalatest">scalatest</a>, <a href="https://github.com/lihaoyi/utest">uTest</a>, and <a href="https://github.com/scalameta/munit">munit</a>.</p>
        <p>Use <a href="https://github.com/MrPowers/chispa">chispa</a> for PySpark applications.</p>
        <p>Read <a href="https://leanpub.com/testing-spark">Testing Spark Applications</a> for a full explanation on the best way to test Spark code!  Good test suites yield higher quality codebases that are easy to refactor.</p>
        
        <h2 id="install" class="section"><a class="anchor-link left" href="#install"><i class="icofont-laika link">&#xef71;</i></a>Install</h2>
        <p>Fetch the JAR file from Maven.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="comment">// for Spark 3
</span><span class="identifier">libraryDependencies</span><span> += </span><span class="string-literal">&quot;com.github.mrpowers&quot;</span><span> %% </span><span class="string-literal">&quot;spark-fast-tests&quot;</span><span> % </span><span class="string-literal">&quot;1.1.0&quot;</span><span> % </span><span class="string-literal">&quot;test&quot;</span></code></pre>
        <p><strong>Important: Future versions of spark-fast-test will no longer support Spark 2.x. We recommend upgrading to Spark 3.x to ensure compatibility with upcoming releases.</strong></p>
        <p>Here&#39;s a link to the releases for different Scala versions:</p>
        <ul>
          <li><a href="https://repo1.maven.org/maven2/com/github/mrpowers/spark-fast-tests_2.11/">Scala 2.11 JAR files</a></li>
          <li><a href="https://repo1.maven.org/maven2/com/github/mrpowers/spark-fast-tests_2.12/">Scala 2.12 JAR files</a></li>
          <li><a href="https://repo1.maven.org/maven2/com/github/mrpowers/spark-fast-tests_2.13/">Scala 2.13 JAR files</a></li>
          <li><a href="https://mvnrepository.com/artifact/MrPowers/spark-fast-tests?repo=spark-packages">Legacy JAR files in Maven</a>.</li>
        </ul>
        <p>You should use Scala 2.11 with Spark 2 and Scala 2.12 / 2.13 with Spark 3.</p>
        
        <h2 id="simple-examples" class="section"><a class="anchor-link left" href="#simple-examples"><i class="icofont-laika link">&#xef71;</i></a>Simple examples</h2>
        <p>The <code>assertSmallDatasetEquality</code> method can be used to compare two Datasets (or two DataFrames).</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">sourceDF</span><span> = </span><span class="type-name">Seq</span><span>(
  (</span><span class="number-literal">1</span><span>),
  (</span><span class="number-literal">5</span><span>)
).</span><span class="identifier">toDF</span><span>(</span><span class="string-literal">&quot;number&quot;</span><span>)

</span><span class="keyword">val</span><span> </span><span class="identifier">expectedDF</span><span> = </span><span class="type-name">Seq</span><span>(
  (</span><span class="number-literal">1</span><span>, </span><span class="string-literal">&quot;word&quot;</span><span>),
  (</span><span class="number-literal">5</span><span>, </span><span class="string-literal">&quot;word&quot;</span><span>)
).</span><span class="identifier">toDF</span><span>(</span><span class="string-literal">&quot;number&quot;</span><span>, </span><span class="string-literal">&quot;word&quot;</span><span>)

</span><span class="identifier">assertSmallDataFrameEquality</span><span>(</span><span class="identifier">sourceDF</span><span>, </span><span class="identifier">expectedDF</span><span>)
</span><span class="comment">// throws a DatasetSchemaMismatch exception</span></code></pre>
        <p>The <code>assertSmallDatasetEquality</code> method can also be used to compare Datasets.</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">sourceDS</span><span> = </span><span class="type-name">Seq</span><span>(
  </span><span class="type-name">Person</span><span>(</span><span class="string-literal">&quot;juan&quot;</span><span>, </span><span class="number-literal">5</span><span>),
  </span><span class="type-name">Person</span><span>(</span><span class="string-literal">&quot;bob&quot;</span><span>, </span><span class="number-literal">1</span><span>),
  </span><span class="type-name">Person</span><span>(</span><span class="string-literal">&quot;li&quot;</span><span>, </span><span class="number-literal">49</span><span>),
  </span><span class="type-name">Person</span><span>(</span><span class="string-literal">&quot;alice&quot;</span><span>, </span><span class="number-literal">5</span><span>)
).</span><span class="identifier">toDS</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">expectedDS</span><span> = </span><span class="type-name">Seq</span><span>(
  </span><span class="type-name">Person</span><span>(</span><span class="string-literal">&quot;juan&quot;</span><span>, </span><span class="number-literal">5</span><span>),
  </span><span class="type-name">Person</span><span>(</span><span class="string-literal">&quot;frank&quot;</span><span>, </span><span class="number-literal">10</span><span>),
  </span><span class="type-name">Person</span><span>(</span><span class="string-literal">&quot;li&quot;</span><span>, </span><span class="number-literal">49</span><span>),
  </span><span class="type-name">Person</span><span>(</span><span class="string-literal">&quot;lucy&quot;</span><span>, </span><span class="number-literal">5</span><span>)
).</span><span class="identifier">toDS</span></code></pre>
        <p><img src="https://raw.githubusercontent.com/mrpowers-io/spark-fast-tests/main/images/assertSmallDatasetEquality_error_message.png" alt="assert_small_dataset_equality_error_message"></p>
        <p>The colors in the error message make it easy to identify the rows that aren&#39;t equal.</p>
        <p>The <code>DatasetComparer</code> has <code>assertSmallDatasetEquality</code> and <code>assertLargeDatasetEquality</code> methods to compare either Datasets or DataFrames.</p>
        <p>If you only need to compare DataFrames, you can use <code>DataFrameComparer</code> with the associated <code>assertSmallDataFrameEquality</code> and <code>assertLargeDataFrameEquality</code> methods.  Under the hood, <code>DataFrameComparer</code> uses the <code>assertSmallDatasetEquality</code> and <code>assertLargeDatasetEquality</code>.</p>
        <p><em>Note : comparing Datasets can be tricky since some column names might be given by Spark when applying transformations.
        Use the <code>ignoreColumnNames</code> boolean to skip name verification.</em></p>
        
        <h2 id="why-is-this-library-fast" class="section"><a class="anchor-link left" href="#why-is-this-library-fast"><i class="icofont-laika link">&#xef71;</i></a>Why is this library fast?</h2>
        <p>This library provides three main methods to test your code.</p>
        <p>Suppose you&#39;d like to test this function:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">myLowerClean</span><span>(</span><span class="identifier">col</span><span>: </span><span class="type-name">Column</span><span>): </span><span class="type-name">Column</span><span> = {
  </span><span class="identifier">lower</span><span>(</span><span class="identifier">regexp_replace</span><span>(</span><span class="identifier">col</span><span>, </span><span class="string-literal">&quot;</span><span class="escape-sequence">\\</span><span class="string-literal">s+&quot;</span><span>, </span><span class="string-literal">&quot;&quot;</span><span>))
}</span></code></pre>
        <p>Here&#39;s how long the tests take to execute:</p>
        <table>
          <thead>
            <tr>
              <th>test method</th>
              <th>runtime</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>assertLargeDataFrameEquality</code></td>
              <td>709 milliseconds</td>
            </tr>
            <tr>
              <td><code>assertSmallDataFrameEquality</code></td>
              <td>166 milliseconds</td>
            </tr>
            <tr>
              <td><code>assertColumnEquality</code></td>
              <td>108 milliseconds</td>
            </tr>
            <tr>
              <td><code>evalString</code></td>
              <td>26 milliseconds</td>
            </tr>
          </tbody>
        </table>
        <p><code>evalString</code> isn&#39;t as robust, but is the fastest.  <code>assertColumnEquality</code> is robust and saves a lot of time.</p>
        <p>Other testing libraries don&#39;t have methods like <code>assertSmallDataFrameEquality</code> or <code>assertColumnEquality</code> so they run slower.</p>
        
        <h2 id="usage" class="section"><a class="anchor-link left" href="#usage"><i class="icofont-laika link">&#xef71;</i></a>Usage</h2>
        <p>The spark-fast-tests project doesn&#39;t provide a SparkSession object in your test suite, so you&#39;ll need to make one yourself.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">apache</span><span>.</span><span class="identifier">spark</span><span>.</span><span class="identifier">sql</span><span>.</span><span class="type-name">SparkSession</span><span>

</span><span class="keyword">trait</span><span> </span><span class="type-name">SparkSessionTestWrapper</span><span> {

  </span><span class="keyword">lazy</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">spark</span><span>: </span><span class="type-name">SparkSession</span><span> = {
    </span><span class="type-name">SparkSession</span><span>
      .</span><span class="identifier">builder</span><span>()
      .</span><span class="identifier">master</span><span>(</span><span class="string-literal">&quot;local&quot;</span><span>)
      .</span><span class="identifier">appName</span><span>(</span><span class="string-literal">&quot;spark session&quot;</span><span>)
      .</span><span class="identifier">config</span><span>(</span><span class="string-literal">&quot;spark.sql.shuffle.partitions&quot;</span><span>, </span><span class="string-literal">&quot;1&quot;</span><span>)
      .</span><span class="identifier">getOrCreate</span><span>()
  }

}</span></code></pre>
        <p>It&#39;s best set the number of shuffle partitions to a small number like one or four in your test suite.  This configuration can make your tests run up to 70% faster.  You can remove this configuration option or adjust it if you&#39;re working with big DataFrames in your test suite.</p>
        <p>Make sure to only use the <code>SparkSessionTestWrapper</code> trait in your test suite.  You don&#39;t want to use test specific configuration (like one shuffle partition) when running production code.</p>
        <p>The <code>DatasetComparer</code> trait defines the <code>assertSmallDatasetEquality</code> method.  Extend your spec file with the <code>SparkSessionTestWrapper</code> trait to create DataFrames and the <code>DatasetComparer</code> trait to make DataFrame comparisons.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">apache</span><span>.</span><span class="identifier">spark</span><span>.</span><span class="identifier">sql</span><span>.</span><span class="identifier">types</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">apache</span><span>.</span><span class="identifier">spark</span><span>.</span><span class="identifier">sql</span><span>.</span><span class="type-name">Row</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">org</span><span>.</span><span class="identifier">apache</span><span>.</span><span class="identifier">spark</span><span>.</span><span class="identifier">sql</span><span>.</span><span class="identifier">functions</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">com</span><span>.</span><span class="identifier">github</span><span>.</span><span class="identifier">mrpowers</span><span>.</span><span class="identifier">spark</span><span>.</span><span class="identifier">fast</span><span>.</span><span class="identifier">tests</span><span>.</span><span class="type-name">DatasetComparer</span><span>

</span><span class="keyword">class</span><span> </span><span class="type-name">DatasetSpec</span><span> </span><span class="keyword">extends</span><span> </span><span class="type-name">FunSpec</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">SparkSessionTestWrapper</span><span> </span><span class="keyword">with</span><span> </span><span class="type-name">DatasetComparer</span><span> {

  </span><span class="keyword">import</span><span> </span><span class="identifier">spark</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">_</span><span>

  </span><span class="identifier">it</span><span>(</span><span class="string-literal">&quot;aliases a DataFrame&quot;</span><span>) {

    </span><span class="keyword">val</span><span> </span><span class="identifier">sourceDF</span><span> = </span><span class="type-name">Seq</span><span>(
      (</span><span class="string-literal">&quot;jose&quot;</span><span>),
      (</span><span class="string-literal">&quot;li&quot;</span><span>),
      (</span><span class="string-literal">&quot;luisa&quot;</span><span>)
    ).</span><span class="identifier">toDF</span><span>(</span><span class="string-literal">&quot;name&quot;</span><span>)

    </span><span class="keyword">val</span><span> </span><span class="identifier">actualDF</span><span> = </span><span class="identifier">sourceDF</span><span>.</span><span class="identifier">select</span><span>(</span><span class="identifier">col</span><span>(</span><span class="string-literal">&quot;name&quot;</span><span>).</span><span class="identifier">alias</span><span>(</span><span class="string-literal">&quot;student&quot;</span><span>))

    </span><span class="keyword">val</span><span> </span><span class="identifier">expectedDF</span><span> = </span><span class="type-name">Seq</span><span>(
      (</span><span class="string-literal">&quot;jose&quot;</span><span>),
      (</span><span class="string-literal">&quot;li&quot;</span><span>),
      (</span><span class="string-literal">&quot;luisa&quot;</span><span>)
    ).</span><span class="identifier">toDF</span><span>(</span><span class="string-literal">&quot;student&quot;</span><span>)

    </span><span class="identifier">assertSmallDatasetEquality</span><span>(</span><span class="identifier">actualDF</span><span>, </span><span class="identifier">expectedDF</span><span>)

  }
}</span></code></pre>
        <p>To compare large DataFrames that are partitioned across different nodes in a cluster, use the <code>assertLargeDatasetEquality</code> method.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">assertLargeDatasetEquality</span><span>(</span><span class="identifier">actualDF</span><span>, </span><span class="identifier">expectedDF</span><span>)</span></code></pre>
        <p><code>assertSmallDatasetEquality</code> is faster for test suites that run on your local machine.  <code>assertLargeDatasetEquality</code> should only be used for DataFrames that are split across nodes in a cluster.</p>
        
        <h3 id="column-equality" class="section"><a class="anchor-link left" href="#column-equality"><i class="icofont-laika link">&#xef71;</i></a>Column Equality</h3>
        <p>The <code>assertColumnEquality</code> method can be used to assess the equality of two columns in a DataFrame.</p>
        <p>Suppose you have the following DataFrame with two columns that are not equal.</p>
        <pre><code>+-------+-------------+
|   name|expected_name|
+-------+-------------+
|   phil|         phil|
| rashid|       rashid|
|matthew|        mateo|
|   sami|         sami|
|     li|         feng|
|   null|         null|
+-------+-------------+</code></pre>
        <p>The following code will throw a <code>ColumnMismatch</code> error message:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">assertColumnEquality</span><span>(</span><span class="identifier">df</span><span>, </span><span class="string-literal">&quot;name&quot;</span><span>, </span><span class="string-literal">&quot;expected_name&quot;</span><span>)</span></code></pre>
        <p><img src="https://raw.githubusercontent.com/mrpowers-io/spark-fast-tests/main/images/assertColumnEquality_error_message.png" alt="assert_column_equality_error_message"></p>
        <p>Mix in the <code>ColumnComparer</code> trait to your test class to access the <code>assertColumnEquality</code> method:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">com</span><span>.</span><span class="identifier">github</span><span>.</span><span class="identifier">mrpowers</span><span>.</span><span class="identifier">spark</span><span>.</span><span class="identifier">fast</span><span>.</span><span class="identifier">tests</span><span>.</span><span class="type-name">ColumnComparer</span><span>

</span><span class="keyword">object</span><span> </span><span class="type-name">MySpecialClassTest</span><span>
    </span><span class="keyword">extends</span><span> </span><span class="type-name">TestSuite</span><span>
    </span><span class="keyword">with</span><span> </span><span class="type-name">ColumnComparer</span><span>
    </span><span class="keyword">with</span><span> </span><span class="type-name">SparkSessionTestWrapper</span><span> {

    </span><span class="comment">// your tests
</span><span>}</span></code></pre>
        
        <h3 id="unordered-dataframe-equality-comparisons" class="section"><a class="anchor-link left" href="#unordered-dataframe-equality-comparisons"><i class="icofont-laika link">&#xef71;</i></a>Unordered DataFrame equality comparisons</h3>
        <p>Suppose you have the following <code>actualDF</code>:</p>
        <pre><code>+------+
|number|
+------+
|     1|
|     5|
+------+</code></pre>
        <p>And suppose you have the following <code>expectedDF</code>:</p>
        <pre><code>+------+
|number|
+------+
|     5|
|     1|
+------+</code></pre>
        <p>The DataFrames have the same columns and rows, but the order is different.</p>
        <p><code>assertSmallDataFrameEquality(sourceDF, expectedDF)</code> will throw a <code>DatasetContentMismatch</code> error.</p>
        <p>We can set the <code>orderedComparison</code> boolean flag to <code>false</code> and spark-fast-tests will sort the DataFrames before performing the comparison.</p>
        <p><code>assertSmallDataFrameEquality(sourceDF, expectedDF, orderedComparison = false)</code> will not throw an error.</p>
        
        <h3 id="equality-comparisons-ignoring-the-nullable-flag" class="section"><a class="anchor-link left" href="#equality-comparisons-ignoring-the-nullable-flag"><i class="icofont-laika link">&#xef71;</i></a>Equality comparisons ignoring the nullable flag</h3>
        <p>You might also want to make equality comparisons that ignore the nullable flags for the DataFrame columns.</p>
        <p>Here is how to use the <code>ignoreNullable</code> flag to compare DataFrames without considering the nullable property of each column.</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">sourceDF</span><span> = </span><span class="identifier">spark</span><span>.</span><span class="identifier">createDF</span><span>(
  </span><span class="type-name">List</span><span>(
    (</span><span class="number-literal">1</span><span>),
    (</span><span class="number-literal">5</span><span>)
  ), </span><span class="type-name">List</span><span>(
    (</span><span class="string-literal">&quot;number&quot;</span><span>, </span><span class="type-name">IntegerType</span><span>, </span><span class="boolean-literal">false</span><span>)
  )
)

</span><span class="keyword">val</span><span> </span><span class="identifier">expectedDF</span><span> = </span><span class="identifier">spark</span><span>.</span><span class="identifier">createDF</span><span>(
  </span><span class="type-name">List</span><span>(
    (</span><span class="number-literal">1</span><span>),
    (</span><span class="number-literal">5</span><span>)
  ), </span><span class="type-name">List</span><span>(
    (</span><span class="string-literal">&quot;number&quot;</span><span>, </span><span class="type-name">IntegerType</span><span>, </span><span class="boolean-literal">true</span><span>)
  )
)

</span><span class="identifier">assertSmallDatasetEquality</span><span>(</span><span class="identifier">sourceDF</span><span>, </span><span class="identifier">expectedDF</span><span>, </span><span class="identifier">ignoreNullable</span><span> = </span><span class="boolean-literal">true</span><span>)</span></code></pre>
        
        <h3 id="approximate-dataframe-equality" class="section"><a class="anchor-link left" href="#approximate-dataframe-equality"><i class="icofont-laika link">&#xef71;</i></a>Approximate DataFrame Equality</h3>
        <p>The <code>assertApproximateDataFrameEquality</code> function is useful for DataFrames that contain <code>DoubleType</code> columns.  The precision threshold must be set when using the <code>assertApproximateDataFrameEquality</code> function.</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">sourceDF</span><span> = </span><span class="identifier">spark</span><span>.</span><span class="identifier">createDF</span><span>(
  </span><span class="type-name">List</span><span>(
    (</span><span class="number-literal">1.2</span><span>),
    (</span><span class="number-literal">5.1</span><span>),
    (</span><span class="literal-value">null</span><span>)
  ), </span><span class="type-name">List</span><span>(
    (</span><span class="string-literal">&quot;number&quot;</span><span>, </span><span class="type-name">DoubleType</span><span>, </span><span class="boolean-literal">true</span><span>)
  )
)

</span><span class="keyword">val</span><span> </span><span class="identifier">expectedDF</span><span> = </span><span class="identifier">spark</span><span>.</span><span class="identifier">createDF</span><span>(
  </span><span class="type-name">List</span><span>(
    (</span><span class="number-literal">1.2</span><span>),
    (</span><span class="number-literal">5.1</span><span>),
    (</span><span class="literal-value">null</span><span>)
  ), </span><span class="type-name">List</span><span>(
    (</span><span class="string-literal">&quot;number&quot;</span><span>, </span><span class="type-name">DoubleType</span><span>, </span><span class="boolean-literal">true</span><span>)
  )
)

</span><span class="identifier">assertApproximateDataFrameEquality</span><span>(</span><span class="identifier">sourceDF</span><span>, </span><span class="identifier">expectedDF</span><span>, </span><span class="number-literal">0.01</span><span>)</span></code></pre>
        
        <h2 id="testing-tips" class="section"><a class="anchor-link left" href="#testing-tips"><i class="icofont-laika link">&#xef71;</i></a>Testing Tips</h2>
        <ul>
          <li>Use column functions instead of UDFs as described in <a href="https://medium.com/@mrpowers/spark-user-defined-functions-udfs-6c849e39443b">this blog post</a></li>
          <li>Try to organize your code as <a href="https://medium.com/@mrpowers/chaining-custom-dataframe-transformations-in-spark-a39e315f903c">custom transformations</a> so it&#39;s easy to test the logic elegantly</li>
          <li>Don&#39;t write tests that read from files or write files.  Dependency injection is a great way to avoid file I/O in you test suite.</li>
        </ul>
        
        <h2 id="alternatives" class="section"><a class="anchor-link left" href="#alternatives"><i class="icofont-laika link">&#xef71;</i></a>Alternatives</h2>
        <p>The <a href="https://github.com/holdenk/spark-testing-base">spark-testing-base</a> project has more features (e.g. streaming support) and is compiled to support a variety of Scala and Spark versions.</p>
        <p>You might want to use spark-fast-tests instead of spark-testing-base in these cases:</p>
        <ul>
          <li>You want to use uTest or a testing framework other than scalatest</li>
          <li>You want to run tests in parallel (you need to set <code>parallelExecution in Test := false</code> with spark-testing-base)</li>
          <li>You don&#39;t want to include hive as a project dependency</li>
          <li>You don&#39;t want to restart the SparkSession after each test file executes so the suite runs faster</li>
        </ul>
        
        <h2 id="publishing" class="section"><a class="anchor-link left" href="#publishing"><i class="icofont-laika link">&#xef71;</i></a>Publishing</h2>
        <p>GPG &amp; Sonatype need to be setup properly before running these commands.  See the <a href="https://github.com/MrPowers/spark-daria">spark-daria</a> README for more information.</p>
        <p>It&#39;s a good idea to always run <code>clean</code> before running any publishing commands.  It&#39;s also important to run <code>clean</code> before different publishing commands as well.</p>
        <p>There is a two step process for publishing.</p>
        <p>Generate Scala 2.11 JAR files:</p>
        <ul>
          <li>Run <code>sbt -Dspark.testVersion=2.4.8</code></li>
          <li>Run <code>&gt; ; + publishSigned; sonatypeBundleRelease</code> to create the JAR files and release them to Maven.</li>
        </ul>
        <p>Generate Scala 2.12 &amp; Scala 2.13 JAR files:</p>
        <ul>
          <li>Run <code>sbt</code></li>
          <li>Run <code>&gt; ; + publishSigned; sonatypeBundleRelease</code></li>
        </ul>
        <p>The <code>publishSigned</code> and <code>sonatypeBundleRelease</code> commands are made available by the <a href="https://github.com/xerial/sbt-sonatype">sbt-sonatype</a> plugin.</p>
        <p>When the release command is run, you&#39;ll be prompted to enter your GPG passphrase.</p>
        <p>The Sonatype credentials should be stored in the <code>~/.sbt/sonatype_credentials</code> file in this format:</p>
        <pre><code>realm=Sonatype Nexus Repository Manager
host=oss.sonatype.org
user=$USERNAME
password=$PASSWORD</code></pre>
        
        <h2 id="additional-goals" class="section"><a class="anchor-link left" href="#additional-goals"><i class="icofont-laika link">&#xef71;</i></a>Additional Goals</h2>
        <ul>
          <li>Use memory efficiently so Spark test runs don&#39;t crash</li>
          <li>Provide readable error messages</li>
          <li>Easy to use in conjunction with other test suites</li>
          <li>Give the user control of the SparkSession</li>
        </ul>
        
        <h2 id="contributing" class="section"><a class="anchor-link left" href="#contributing"><i class="icofont-laika link">&#xef71;</i></a>Contributing</h2>
        <p>Open an issue or send a pull request to contribute.  Anyone that makes good contributions to the project will be promoted to project maintainer status.</p>
        
        <h2 id="utest-settings-to-display-color-output" class="section"><a class="anchor-link left" href="#utest-settings-to-display-color-output"><i class="icofont-laika link">&#xef71;</i></a>uTest settings to display color output</h2>
        <p>Create a <code>CustomFramework</code> class with overrides that turn off the default uTest color settings.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">package</span><span> </span><span class="identifier">com</span><span>.</span><span class="identifier">github</span><span>.</span><span class="identifier">mrpowers</span><span>.</span><span class="identifier">spark</span><span>.</span><span class="identifier">fast</span><span>.</span><span class="identifier">tests</span><span>

</span><span class="keyword">class</span><span> </span><span class="type-name">CustomFramework</span><span> </span><span class="keyword">extends</span><span> </span><span class="identifier">utest</span><span>.</span><span class="identifier">runner</span><span>.</span><span class="type-name">Framework</span><span> {
  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">formatWrapWidth</span><span>: </span><span class="type-name">Int</span><span> = </span><span class="number-literal">300</span><span>
  </span><span class="comment">// turn off the default exception message color, so spark-fast-tests
</span><span>  </span><span class="comment">// can send messages with custom colors
</span><span>  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">exceptionMsgColor</span><span> = </span><span class="identifier">toggledColor</span><span>(</span><span class="identifier">utest</span><span>.</span><span class="identifier">ufansi</span><span>.</span><span class="type-name">Attrs</span><span>.</span><span class="type-name">Empty</span><span>)
  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">exceptionPrefixColor</span><span> = </span><span class="identifier">toggledColor</span><span>(</span><span class="identifier">utest</span><span>.</span><span class="identifier">ufansi</span><span>.</span><span class="type-name">Attrs</span><span>.</span><span class="type-name">Empty</span><span>)
  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">exceptionMethodColor</span><span> = </span><span class="identifier">toggledColor</span><span>(</span><span class="identifier">utest</span><span>.</span><span class="identifier">ufansi</span><span>.</span><span class="type-name">Attrs</span><span>.</span><span class="type-name">Empty</span><span>)
  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">exceptionPunctuationColor</span><span> = </span><span class="identifier">toggledColor</span><span>(</span><span class="identifier">utest</span><span>.</span><span class="identifier">ufansi</span><span>.</span><span class="type-name">Attrs</span><span>.</span><span class="type-name">Empty</span><span>)
  </span><span class="keyword">override</span><span> </span><span class="keyword">def</span><span> </span><span class="declaration-name">exceptionLineNumberColor</span><span> = </span><span class="identifier">toggledColor</span><span>(</span><span class="identifier">utest</span><span>.</span><span class="identifier">ufansi</span><span>.</span><span class="type-name">Attrs</span><span>.</span><span class="type-name">Empty</span><span>)
}</span></code></pre>
        <p>Update the <code>build.sbt</code> file to use the <code>CustomFramework</code> class:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="identifier">testFrameworks</span><span> += </span><span class="keyword">new</span><span> </span><span class="type-name">TestFramework</span><span>(</span><span class="string-literal">&quot;com.github.mrpowers.spark.fast.tests.CustomFramework&quot;</span><span>)</span></code></pre>

        
<hr class="footer-rule"/>
<footer>
  Site generated by <a href="https://typelevel.org/Laika/">Laika</a> with the Helium theme.
</footer>


      </main>

    </div>

  </body>

</html>